# Lab 4新增API
- 基于“邀请下单”和“点评功能”的需求。
- 文档包括:接口地址与请求方式、接口名称与功能描述、请求体与响应体结构、请求示例与响应示例以及异常 API 调用。


### 1. 获取用户邀请码
- **接口地址**: `/api/invitation/code`
- **请求方式**: GET
- **接口名称**: 获取邀请码
- **功能描述**: 获取当前登录用户的唯一邀请码，若用户尚未拥有邀请码，则自动生成一个6位随机字母数字组合的邀请码并绑定。

##### 请求体
- 无请求参数

##### 响应体
| 字段名   | 数据类型 | 是否必填 | 说明               |
|----------|----------|----------|--------------------|
| code     | string   | 是       | 用户的邀请码       |
| message  | string   | 是       | 操作状态信息       |

##### 请求示例
```
GET /api/invitation/code
Authorization: Bearer <token>
```

##### 响应示例（成功）
```json
{
  "code": "A1B2C3",
  "message": "Success"
}
```

##### 异常 API 调用
- **错误码**: 401 Unauthorized
- **描述**: 用户未登录或 token 无效
- **响应体结构**:
  | 字段名   | 数据类型 | 是否必填 | 说明         |
  |----------|----------|----------|--------------|
  | detail   | string   | 是       | 错误描述     |
- **响应示例**:
  ```json
  {
    "detail": "Not authenticated"
  }
  ```
- **错误码**: 404 Not Found
- **描述**: 用户不存在
- **响应体结构**:
  | 字段名   | 数据类型 | 是否必填 | 说明         |
  |----------|----------|----------|--------------|
  | detail   | string   | 是       | 错误描述     |
- **响应示例**:
  ```json
  {
    "detail": "用户不存在"
  }
  ```

#### 2. 获取邀请记录
- **接口地址**: `/api/invitation/records`
- **请求方式**: GET
- **接口名称**: 获取邀请记录
- **功能描述**: 查询当前登录用户作为邀请人成功邀请的新用户记录，包括被邀请用户ID、用户名、下单时间和实付金额。

##### 请求体
- 无请求参数

##### 响应体
| 字段名       | 数据类型 | 是否必填 | 说明                     |
|--------------|----------|----------|--------------------------|
| records      | array    | 是       | 邀请记录列表             |
| total_invited| integer  | 是       | 有效邀请的总次数         |
| records[].user_id | integer | 是     | 被邀请用户ID             |
| records[].username | string  | 是     | 被邀请用户的用户名       |
| records[].order_time | string | 是     | 下单时间（ISO格式）      |
| records[].amount | float   | 是     | 订单实付金额             |

##### 请求示例
```
GET /api/invitation/records
Authorization: Bearer <token>
```

##### 响应示例（成功）
```json
{
  "records": [
    {
      "user_id": 2,
      "username": "Bob",
      "order_time": "2025-05-24T20:00:00Z",
      "amount": 15.50
    }
  ],
  "total_invited": 1
}
```

##### 异常 API 调用
- **错误码**: 401 Unauthorized
- **描述**: 用户未登录或 token 无效
- **响应体结构**:
  | 字段名   | 数据类型 | 是否必填 | 说明         |
  |----------|----------|----------|--------------|
  | detail   | string   | 是       | 错误描述     |
- **响应示例**:
  ```json
  {
    "detail": "Not authenticated"
  }
  ```

---

#### 3. 创建订单（有修改）
- **接口地址**: `/api/orders`
- **请求方式**: POST
- **接口名称**: 创建订单
- **功能描述**: 用户创建订单，可选择使用优惠券或填写邀请码，订单创建后记录邀请信息（如适用）并触发相关通知。

##### 请求体
| 字段名         | 数据类型 | 是否必填 | 说明                       |
|----------------|----------|----------|----------------------------|
| package_id     | integer  | 是       | 套餐ID                     |
| coupon_id      | integer  | 否       | 优惠券ID（可选）           |
| invitation_code| string   | 否       | 邀请码（可选）             |

##### 响应体
| 字段名       | 数据类型 | 是否必填 | 说明                     |
|--------------|----------|----------|--------------------------|
| id           | integer  | 是       | 订单ID                   |
| voucher_code | string   | 是       | 订单券码（16位数字）     |
| order_amount | float    | 是       | 订单实付金额             |
| created_at   | string   | 是       | 订单创建时间（ISO格式）  |

##### 请求示例
```json
POST /api/orders
Authorization: Bearer <token>
{
  "package_id": 1,
  "coupon_id": 1,
  "invitation_code": "A1B2C3"
}
```

##### 响应示例（成功）
```json
{
  "id": 1,
  "voucher_code": "1234567890123456",
  "order_amount": 45.67,
  "created_at": "2025-05-24T20:00:00Z"
}
```

##### 异常 API 调用
- **错误码**: 400 Bad Request
- **描述**: 无效邀请码
- **响应体结构**:
  | 字段名   | 数据类型 | 是否必填 | 说明         |
  |----------|----------|----------|--------------|
  | detail   | string   | 是       | 错误描述     |
- **响应示例**:
  ```json
  {
    "detail": "无效的邀请码"
  }
  ```
- **错误码**: 400 Bad Request
- **描述**: 仅首次下单可使用邀请码
- **响应体结构**:
  | 字段名   | 数据类型 | 是否必填 | 说明         |
  |----------|----------|----------|--------------|
  | detail   | string   | 是       | 错误描述     |
- **响应示例**:
  ```json
  {
    "detail": "仅首次下单可使用邀请码"
  }
  ```
- **错误码**: 400 Bad Request
- **描述**: 订单金额需超过10元
- **响应体结构**:
  | 字段名   | 数据类型 | 是否必填 | 说明         |
  |----------|----------|----------|--------------|
  | detail   | string   | 是       | 错误描述     |
- **响应示例**:
  ```json
  {
    "detail": "订单金额需超过10元"
  }
  ```
- **错误码**: 404 Not Found
- **描述**: 未找到指定套餐
- **响应体结构**:
  | 字段名   | 数据类型 | 是否必填 | 说明         |
  |----------|----------|----------|--------------|
  | detail   | string   | 是       | 错误描述     |
- **响应示例**:
  ```json
  {
    "detail": "未找到指定套餐"
  }
  ```
- **错误码**: 401 Unauthorized
- **描述**: 用户未登录或 token 无效
- **响应体结构**:
  | 字段名   | 数据类型 | 是否必填 | 说明         |
  |----------|----------|----------|--------------|
  | detail   | string   | 是       | 错误描述     |
- **响应示例**:
  ```json
  {
    "detail": "Not authenticated"
  }
  ```


#### 点评相关待补充

### 注意事项
- 所有接口需携带 `Authorization: Bearer <token>` 头以验证用户身份。
- 文档基于 Lab 4 新增接口，未包含之前 Lab 的内容。
- 异常处理涵盖常见场景，确保用户友好。
